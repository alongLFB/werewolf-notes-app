# 夜间行动角色关联系统

## 改进概述

将夜间行动系统从"任意角色可执行任意行动"改为"角色绑定行动"，更符合狼人杀游戏规则。

## 角色行动映射

### 🐺 狼人 (Werewolf)

- **可执行行动**: 击杀
- **行动类型**: `werewolf_kill`
- **需要目标**: 是
- **说明**: 狼人只能选择击杀其他玩家

### 🔍 预言家 (Seer)

- **可执行行动**: 查验身份
- **行动类型**: `seer_check`
- **需要目标**: 是
- **需要结果**: 是 (好人/狼人)
- **说明**: 预言家只能查验其他玩家的身份

### 🧪 女巫 (Witch)

- **可执行行动**:
  - 使用解药救人 (`witch_save`)
  - 使用毒药毒人 (`witch_poison`)
- **需要目标**: 是
- **说明**: 女巫可以救人或毒人，通常救药用于被狼人击杀的玩家

### 🛡️ 守卫 (Guard)

- **可执行行动**: 守护保护
- **行动类型**: `guard_protect`
- **需要目标**: 是
- **说明**: 守卫只能保护其他玩家

### 👨‍🌾 村民及其他角色

- **可执行行动**: 无
- **说明**: 普通村民和其他特殊角色在夜晚无特殊行动

## 界面改进

### 1. 行动者筛选

- **原来**: 显示所有有角色的玩家
- **现在**: 只显示有夜间行动能力的角色 (狼人、预言家、女巫、守卫)

### 2. 行动类型动态显示

- **原来**: 固定显示所有行动类型
- **现在**: 根据选中的角色动态显示可执行的行动

```tsx
// 角色行动映射
const getAvailableActions = (role: string | undefined) => {
  switch (role) {
    case "werewolf":
      return [{ value: "werewolf_kill", label: "击杀" }];
    case "seer":
      return [{ value: "seer_check", label: "查验身份" }];
    case "witch":
      return [
        { value: "witch_save", label: "使用解药救人" },
        { value: "witch_poison", label: "使用毒药毒人" },
      ];
    case "guard":
      return [{ value: "guard_protect", label: "守护保护" }];
    default:
      return [];
  }
};
```

### 3. 智能表单重置

- 选择新的行动者时，自动重置行动类型、目标和结果
- 防止出现角色与行动不匹配的情况

### 4. 增强的验证

- **目标检查**: 所有夜间行动都需要选择目标玩家
- **结果检查**: 预言家查验必须填写结果 (好人/狼人)
- **实时禁用**: 按钮会根据表单完整性实时启用/禁用

### 5. 用户体验优化

- **提示信息**: 女巫救人时提示"通常是被狼人击杀的玩家"
- **禁用状态**: 未选择行动者时，行动类型和目标选择会被禁用
- **清晰标签**: 每个角色的行动都有明确的中文标签

## 操作流程

### 标准夜晚流程

1. **选择行动者**: 从有夜间行动能力的角色中选择
2. **选择行动**: 系统自动显示该角色可执行的行动类型
3. **选择目标**: 选择行动的目标玩家
4. **填写结果**: 如果是预言家查验，填写查验结果
5. **记录行动**: 点击按钮记录该行动
6. **重复操作**: 为其他角色记录行动
7. **结算夜晚**: 点击"结算夜晚行动"统一处理所有行动

### 示例：第一回合夜晚

1. 选择狼人 → 击杀 → 选择目标玩家 → 记录
2. 选择预言家 → 查验身份 → 选择目标玩家 → 填写结果 → 记录
3. 选择女巫 → 使用毒药毒人 → 选择目标玩家 → 记录
4. 点击"结算夜晚行动"
5. 进入白天 → 警长选举 → 公布昨夜死亡

## 优势

1. **规则合规**: 严格按照狼人杀游戏规则，角色只能执行对应的行动
2. **防误操作**: 避免了"村民击杀"等不合理的操作
3. **操作简化**: 用户不需要记忆哪些角色能做哪些行动
4. **数据准确**: 确保夜间行动数据的逻辑一致性
5. **用户友好**: 通过界面引导用户正确操作

现在夜间行动系统完全按照狼人杀游戏的标准规则运行，每个角色只能执行其对应的夜间行动！
