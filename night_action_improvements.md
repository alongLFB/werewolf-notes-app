# 夜晚行动系统改进

## 主要改进内容

### 1. 女巫药品状态管理
- 为 `Player` 类型添加了 `hasAntidote` 和 `hasPoison` 字段
- 在设置玩家角色为女巫时自动初始化药品状态
- 在夜晚结算后自动更新女巫的药品状态（使用后药品消失）

### 2. 夜晚行动优先级规则
夜晚结算按以下顺序处理：
1. **女巫毒杀**：最高优先级，无法被任何保护阻挡
2. **狼人击杀**：可以被女巫解药或守卫保护阻止
3. **守卫保护 + 女巫解药**：如果同时作用于同一目标，会相互抵消，目标仍然死亡

### 3. UI 改进
- 在行动者选择中显示女巫的药品状态
- 为女巫行动类型选择增加药品可用性检查
- 添加夜晚结算规则说明
- 增加女巫救人的操作提示

### 4. 使用流程
1. **狼人击杀**：先记录狼人的击杀行动
2. **女巫救人**：查看狼人击杀的目标，决定是否使用解药救人
3. **女巫毒人**：选择要毒杀的目标（如果还有毒药）
4. **守卫保护**：选择要保护的目标
5. **结算**：点击"结算夜晚行动"按钮，系统会按优先级处理所有行动

### 5. 重要提醒
- 女巫的解药和毒药各只能使用一次
- 使用药品后会在结算时消失，无法恢复
- 女巫不能在同一夜晚救人和毒人
- 结算前可以修改行动，结算后无法更改

## 技术实现

### 类型定义更新
```typescript
export interface Player {
  // ... 其他字段
  hasAntidote?: boolean; // 是否还有解药
  hasPoison?: boolean;   // 是否还有毒药
}
```

### 新增方法
```typescript
getWitchPotionStatus: (playerId: number) => { 
  hasAntidote: boolean; 
  hasPoison: boolean 
} | null;
```

### 夜晚结算逻辑更新
- 在处理完所有死亡后，更新女巫的药品状态
- 使用解药的女巫 `hasAntidote` 设为 `false`
- 使用毒药的女巫 `hasPoison` 设为 `false`

## 测试建议

1. 创建游戏并设置女巫角色
2. 进入夜晚阶段，检查女巫显示"[解药、毒药]"
3. 记录狼人击杀行动
4. 记录女巫救人行动
5. 结算夜晚行动，验证：
   - 被救的玩家没有死亡
   - 女巫显示"[毒药]"（解药已使用）
6. 下一夜测试毒药使用和药品消失
